<template>
  <div class="row">
    <div class="col col-2"></div>
    <div class="col col-8">
      <b class="title-xs">Эфиры</b>
      <div class="broadcast-day" v-for="(day, dayIdx) in list" :key="dayIdx">
        <div class="broadcast-day-header">
          <button class="duplicate-broadcast-day">
            <span>Создать копию</span>
            <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19.5 22.3125H12.75C12.3024 22.3125 11.8732 22.1347 11.5568 21.8182C11.2403 21.5018 11.0625 21.0726 11.0625 20.625V11.625C11.0625 11.1774 11.2403 10.7482 11.5568 10.4318C11.8732 10.1153 12.3024 9.9375 12.75 9.9375H19.5C19.9476 9.9375 20.3768 10.1153 20.6932 10.4318C21.0097 10.7482 21.1875 11.1774 21.1875 11.625V20.625C21.1875 21.0726 21.0097 21.5018 20.6932 21.8182C20.3768 22.1347 19.9476 22.3125 19.5 22.3125ZM12.75 11.0625C12.6008 11.0625 12.4577 11.1218 12.3523 11.2273C12.2468 11.3327 12.1875 11.4758 12.1875 11.625V20.625C12.1875 20.7742 12.2468 20.9173 12.3523 21.0227C12.4577 21.1282 12.6008 21.1875 12.75 21.1875H19.5C19.6492 21.1875 19.7923 21.1282 19.8977 21.0227C20.0032 20.9173 20.0625 20.7742 20.0625 20.625V11.625C20.0625 11.4758 20.0032 11.3327 19.8977 11.2273C19.7923 11.1218 19.6492 11.0625 19.5 11.0625H12.75Z" fill="white"/>
              <path d="M9.375 16.6875C9.22582 16.6875 9.08274 16.6282 8.97725 16.5227C8.87176 16.4173 8.8125 16.2742 8.8125 16.125V9.375C8.8125 8.92745 8.99029 8.49822 9.30676 8.18176C9.62322 7.86529 10.0524 7.6875 10.5 7.6875H16.125C16.2742 7.6875 16.4173 7.74676 16.5227 7.85225C16.6282 7.95774 16.6875 8.10082 16.6875 8.25C16.6875 8.39918 16.6282 8.54226 16.5227 8.64775C16.4173 8.75324 16.2742 8.8125 16.125 8.8125H10.5C10.3508 8.8125 10.2077 8.87176 10.1023 8.97725C9.99676 9.08274 9.9375 9.22582 9.9375 9.375V16.125C9.9375 16.2742 9.87824 16.4173 9.77275 16.5227C9.66726 16.6282 9.52418 16.6875 9.375 16.6875Z" fill="white"/>
            </svg>
          </button>
          <div class="broadcast-day-date">{{ dayIdx }}</div>
        </div>
        <div class="broadcast-list">
          <div class="broadcast-list-header">
            <div class="broadcast-data">Время</div>
            <div class="broadcast-data">Курс</div>
            <div class="broadcast-data">Тема</div>
            <div class="broadcast-data">Статус урока</div>
          </div>
          <div class="broadcast-list-row" v-for="(item, itemIdx) in day" :key="itemIdx">
            <div class="broadcast-data">{{ getTime(item.date) }}</div>
            <div class="broadcast-data"><p>{{ item.course.name }}</p></div>
            <div class="broadcast-data">
              <p>{{ item.topic }}</p>
            </div>
            <div class="broadcast-data">
              <v-button size="btn-sm" type="btn-basic" v-if="item.status.id === 1" @click="handleStart(item.id)">Начать</v-button>
              <router-link class="btn btn-sm btn-success" v-if="item.status.id === 2" :to="{name: 'VAdminBroadcastEdit', params: {id: item.id}}">Перейти</router-link>
              <span class="broadcast-completed" v-if="item.status.id === 3">Завершен</span>
            </div>
            <div class="broadcast-data">
              <button class="btn-plain" @click="$router.push({name: 'VAdminBroadcastEdit', params: {id: item.id}})">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3.12488 12.2619C3.01365 12.2619 2.90492 12.2289 2.81243 12.1671C2.71995 12.1053 2.64788 12.0175 2.60531 11.9147C2.56275 11.8119 2.55161 11.6988 2.5733 11.5897C2.595 11.4806 2.64855 11.3804 2.72719 11.3018L11.5174 2.51157C11.5693 2.45784 11.6313 2.41499 11.7 2.38551C11.7686 2.35603 11.8424 2.34051 11.9171 2.33986C11.9918 2.33922 12.0658 2.35345 12.135 2.38173C12.2041 2.41001 12.2669 2.45178 12.3197 2.5046C12.3725 2.55741 12.4143 2.62021 12.4426 2.68934C12.4709 2.75847 12.4851 2.83254 12.4845 2.90723C12.4838 2.98192 12.4683 3.05573 12.4388 3.12436C12.4093 3.19299 12.3665 3.25505 12.3128 3.30694L3.52257 12.0971C3.41288 12.2068 3.26888 12.2619 3.12488 12.2619Z" fill="#414141"/>
                  <path d="M2.25045 16.3126C2.16652 16.3127 2.08363 16.294 2.00787 16.2578C1.93211 16.2217 1.8654 16.1691 1.81262 16.1038C1.75984 16.0385 1.72234 15.9623 1.70286 15.8807C1.68338 15.799 1.68242 15.714 1.70004 15.632L2.56911 11.5811C2.5844 11.5087 2.61384 11.44 2.65574 11.379C2.69763 11.318 2.75116 11.2658 2.81325 11.2255C2.87534 11.1853 2.94477 11.1576 3.01756 11.1442C3.09035 11.1308 3.16507 11.1319 3.23745 11.1474C3.30982 11.1629 3.37841 11.1926 3.4393 11.2347C3.50019 11.2768 3.55217 11.3305 3.59227 11.3927C3.63237 11.4549 3.65979 11.5244 3.67297 11.5972C3.68615 11.6701 3.68483 11.7448 3.66907 11.8171L2.80001 15.868C2.77306 15.9937 2.70381 16.1065 2.60381 16.1874C2.5038 16.2683 2.37909 16.3125 2.25045 16.3126ZM6.30073 15.4435C6.1895 15.4435 6.08077 15.4105 5.98829 15.3487C5.8958 15.2869 5.82373 15.1991 5.78116 15.0963C5.7386 14.9935 5.72746 14.8804 5.74915 14.7713C5.77085 14.6622 5.8244 14.562 5.90304 14.4834L14.6932 5.69345C14.7451 5.63973 14.8072 5.59688 14.8758 5.5674C14.9444 5.53792 15.0183 5.5224 15.0929 5.52175C15.1676 5.5211 15.2417 5.53533 15.3108 5.56362C15.38 5.5919 15.4428 5.63367 15.4956 5.68648C15.5484 5.7393 15.5902 5.8021 15.6184 5.87123C15.6467 5.94036 15.661 6.01443 15.6603 6.08912C15.6597 6.1638 15.6441 6.23762 15.6147 6.30624C15.5852 6.37487 15.5423 6.43694 15.4886 6.48883L6.6987 15.2787C6.6465 15.3311 6.58447 15.3726 6.51617 15.4009C6.44787 15.4292 6.37465 15.4437 6.30073 15.4435Z" fill="#414141"/>
                  <path d="M2.24789 16.3126C2.10928 16.312 1.97577 16.2603 1.87294 16.1673C1.7701 16.0744 1.70518 15.9468 1.69062 15.8089C1.67605 15.6711 1.71287 15.5327 1.79401 15.4203C1.87515 15.308 1.99491 15.2295 2.13033 15.1999L6.18117 14.3309C6.32684 14.3001 6.47876 14.3283 6.60364 14.4094C6.72853 14.4904 6.81619 14.6177 6.84742 14.7633C6.87864 14.9088 6.85089 15.0608 6.77024 15.186C6.68958 15.3111 6.56261 15.3992 6.41714 15.4309L2.3663 16.2999C2.3274 16.3084 2.2877 16.3126 2.24789 16.3126ZM13.4985 8.24435C13.4246 8.24449 13.3514 8.23 13.2831 8.20171C13.2149 8.17342 13.1529 8.1319 13.1008 8.07954L9.91898 4.89776C9.86526 4.84587 9.82241 4.7838 9.79293 4.71517C9.76345 4.64655 9.74793 4.57273 9.74728 4.49805C9.74663 4.42336 9.76086 4.34929 9.78915 4.28016C9.81743 4.21103 9.8592 4.14823 9.91201 4.09541C9.96483 4.0426 10.0276 4.00083 10.0968 3.97255C10.1659 3.94426 10.24 3.93003 10.3146 3.93068C10.3893 3.93133 10.4631 3.94685 10.5318 3.97633C10.6004 4.00581 10.6625 4.04866 10.7144 4.10238L13.8961 7.28416C13.9748 7.36283 14.0283 7.46305 14.05 7.57215C14.0717 7.68124 14.0606 7.79433 14.018 7.89709C13.9755 7.99986 13.9034 8.08771 13.8109 8.14952C13.7184 8.21132 13.6097 8.24433 13.4985 8.24435ZM15.0895 6.6536C14.9782 6.65369 14.8693 6.62075 14.7767 6.55894C14.6842 6.49714 14.612 6.40926 14.5694 6.30642C14.5268 6.20358 14.5156 6.09041 14.5374 5.98124C14.5591 5.87207 14.6128 5.7718 14.6915 5.69313C15.0045 5.3801 15.177 4.95626 15.177 4.50007C15.177 4.04388 15.0045 3.62004 14.6915 3.30701C14.3782 2.9937 13.9544 2.82129 13.4982 2.82129C13.042 2.82129 12.6181 2.9937 12.3051 3.30701C12.2529 3.35925 12.1908 3.40069 12.1226 3.42897C12.0543 3.45724 11.9812 3.47179 11.9073 3.47179C11.8334 3.47179 11.7602 3.45724 11.692 3.42897C11.6237 3.40069 11.5617 3.35925 11.5095 3.30701C11.4572 3.25476 11.4158 3.19274 11.3875 3.12448C11.3592 3.05622 11.3447 2.98306 11.3447 2.90918C11.3447 2.8353 11.3592 2.76214 11.3875 2.69388C11.4158 2.62562 11.4572 2.5636 11.5095 2.51135C12.0348 1.9857 12.741 1.69629 13.4982 1.69629C14.255 1.69629 14.9615 1.9857 15.4869 2.51135C16.0125 3.03673 16.302 3.74295 16.302 4.50007C16.302 5.2572 16.0125 5.96341 15.4869 6.48879C15.4348 6.54112 15.3729 6.58262 15.3047 6.61091C15.2365 6.63919 15.1633 6.6537 15.0895 6.6536Z" fill="#414141"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col col-2">
      <div class="sidebar-btn-group">
        <v-button type="btn-primary" @click="$router.push({name: 'VAdminBroadcastAdd'})">Новое событие</v-button>
      </div>
    </div>
  </div>
</template>

<script>
import VButton from "@/components/VButton";

export default {
  name: "VAdminBroadcast",

  components: {
    VButton
  },

  mounted() {
    this.fetchCourseList()
    this.getList()
  },

  data() {
    return {
      list: [],
      courseList: []
    }
  },

  methods: {
    fetchCourseList() {
      this.API.course.getList()
          .then(res => {
            this.courseList = res.data.items
          })
    },
    getList() {
      this.API.broadcast.getList()
          .then(res => {
            this.list = res.data.items
          })
    },
    getTime(date) {
      return date.split(' ').pop()
    },
    handleStart(id) {
      this.API.broadcast.start(id)
          .then(() => {
            this.getList()
          })
    }
  }

}
</script>

<style scoped>

</style>
