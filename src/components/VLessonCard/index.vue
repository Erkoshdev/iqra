<template>
  <div class="lesson-card" :class="{selected: selectedId.length}">
    <input
        type="checkbox"
        class="lesson-card-checkbox"
        name="lesson"
        v-if="isSelectCard"
        :value="id"
        v-model="selectedId"
        @change="selectLesson(id)"
    >
    <div class="lesson-card-name">{{ name }}</div>
    <div class="lesson-card-time" v-if="isTaskCard">{{ taskQuestionCount }} вопросов</div>
<!--    <div class="lesson-card-time" v-else>{{ duration }}</div>-->
    <div class="lesson-card-tools">
<!--      <span class="lesson-card-disabled" v-if="statusId === 2">Недоступно</span>-->
      <a class="lesson-card-info" v-if="isHasOpen" @click="handleEdit">Открыть</a>
      <span class="lesson-card-success" v-if="statusId === 4">Пройдено</span>
<!--      <span class="lesson-card-info" v-if="isSelectCard">Выбрать</span>-->
      <v-dropdown class="status-dropdown" v-if="isEditingAccess">
        <template #base>
          <button class="status-toggle" :class="getClass()">
            {{ statusName }}
            <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 6L8.5 11L16 6" stroke="black" stroke-width="1.5"/>
            </svg>
          </button>
        </template>
        <template #dropdown="{ handleShow }">
          <ul class="status-list">
            <li v-for="(item, itemIdx) in statusList" :key="itemIdx">
              <a class="status-link" @click.prevent="handleChangeAccessStatus(item.id, handleShow)">{{ item.label }}</a>
            </li>
          </ul>
        </template>
      </v-dropdown>
    </div>
    <div class="lesson-card-redact-tools" v-if="isEditing">
      <v-dropdown class="redact-dropdown">
        <template #base>
          <button class="btn-plain">
            <i class="i-dots"></i>
          </button>
        </template>
        <template #dropdown="{ handleShow }">
          <div class="redact-dropdown-list">
<!--            <a href="#" class="redact-dropdown-item" @click="handleClick(handleShow)">-->
<!--              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">-->
<!--                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.05059 4.56023C0.880239 5.55478 0.149372 6.54083 0.0888374 6.62365C0.0311088 6.70273 0 6.79812 0 6.89603C0 6.99395 0.0311088 7.08933 0.0888374 7.16842C0.213771 7.33951 3.19392 11.3577 6.99994 11.3577C7.55777 11.3577 8.09786 11.2713 8.61382 11.1235L7.84643 10.3561C7.56922 10.4068 7.28659 10.4346 6.99994 10.4346C4.1964 10.4346 1.76824 7.76766 1.04945 6.8958C1.34477 6.53682 1.92866 5.87441 2.70933 5.21898L2.05059 4.56023ZM4.23478 6.74443C4.23206 6.79466 4.23068 6.84524 4.23068 6.89614C4.23068 8.42308 5.47299 9.66539 6.99992 9.66539C7.05082 9.66539 7.10141 9.66401 7.15164 9.66128L4.23478 6.74443ZM9.06172 8.74294C9.50141 8.25257 9.76917 7.60503 9.76917 6.89614C9.76917 5.36921 8.52686 4.1269 6.99992 4.1269C6.29103 4.1269 5.64349 4.39466 5.15313 4.83434L5.807 5.48822C6.12898 5.21499 6.54554 5.05 6.99992 5.05C8.01791 5.05 8.84607 5.87816 8.84607 6.89614C8.84607 7.35053 8.68108 7.76709 8.40785 8.08907L9.06172 8.74294ZM9.8876 9.56882C11.3664 8.71061 12.4976 7.44684 12.9504 6.89643C12.2313 6.0241 9.80334 3.35764 6.99994 3.35764C6.07149 3.35764 5.18524 3.64873 4.3888 4.07001L3.70684 3.38806C4.67974 2.83483 5.7987 2.43457 6.99994 2.43457C10.806 2.43457 13.786 6.45272 13.911 6.62381C13.9688 6.70286 14 6.79825 14 6.89618C14 6.99411 13.9688 7.0895 13.911 7.16855C13.8291 7.28047 12.5234 9.04165 10.5632 10.2444L9.8876 9.56882Z" fill="black"/>-->
<!--                <path d="M1.82617 1.82617L12.174 12.174" stroke="black" stroke-linecap="round"/>-->
<!--              </svg>-->
<!--              <span>Скрыть</span>-->
<!--            </a>-->
            <a href="#" class="redact-dropdown-item" @click="handleEdit(id, handleShow)">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                <path d="M2.42911 9.53701C2.34259 9.53699 2.25802 9.51133 2.18609 9.46325C2.11416 9.41518 2.0581 9.34686 2.025 9.26692C1.99189 9.18699 1.98323 9.09904 2.0001 9.01419C2.01697 8.92933 2.05863 8.85139 2.11979 8.7902L8.95661 1.95339C8.99696 1.9116 9.04524 1.87827 9.09862 1.85534C9.15199 1.83241 9.2094 1.82035 9.26749 1.81984C9.32558 1.81934 9.38319 1.83041 9.43696 1.8524C9.49073 1.8744 9.53958 1.90689 9.58065 1.94796C9.62173 1.98904 9.65422 2.03789 9.67622 2.09166C9.69821 2.14543 9.70928 2.20303 9.70878 2.26113C9.70827 2.31922 9.6962 2.37663 9.67327 2.43C9.65035 2.48338 9.61702 2.53165 9.57523 2.57201L2.73842 9.40883C2.65311 9.49414 2.54111 9.53701 2.42911 9.53701Z" fill="black"/>
                <path d="M1.75377 12.6873C1.68849 12.6874 1.62402 12.6728 1.5651 12.6447C1.50617 12.6166 1.45428 12.5757 1.41323 12.5249C1.37218 12.4742 1.34301 12.4149 1.32786 12.3514C1.31271 12.2879 1.31196 12.2218 1.32567 12.158L2.00161 9.00731C2.01351 8.95098 2.03641 8.89756 2.06899 8.8501C2.10158 8.80264 2.14321 8.76208 2.1915 8.73074C2.23979 8.6994 2.29379 8.6779 2.35041 8.66747C2.40702 8.65704 2.46514 8.65789 2.52143 8.66996C2.57772 8.68204 2.63107 8.7051 2.67843 8.73784C2.72579 8.77057 2.76622 8.81233 2.7974 8.86072C2.82859 8.90911 2.84992 8.96318 2.86017 9.01983C2.87042 9.07648 2.86939 9.13459 2.85714 9.19084L2.1812 12.3415C2.16024 12.4393 2.10638 12.527 2.0286 12.59C1.95082 12.6529 1.85382 12.6873 1.75377 12.6873ZM4.90399 12.0114C4.81747 12.0114 4.7329 11.9857 4.66097 11.9376C4.58904 11.8896 4.53298 11.8212 4.49988 11.7413C4.46677 11.6614 4.45811 11.5734 4.47498 11.4886C4.49185 11.4037 4.53351 11.3258 4.59467 11.2646L11.4315 4.428C11.4718 4.38621 11.5201 4.35288 11.5735 4.32995C11.6269 4.30702 11.6843 4.29495 11.7424 4.29445C11.8005 4.29395 11.8581 4.30501 11.9118 4.32701C11.9656 4.34901 12.0145 4.3815 12.0555 4.42257C12.0966 4.46365 12.1291 4.5125 12.1511 4.56627C12.1731 4.62003 12.1842 4.67764 12.1837 4.73574C12.1832 4.79383 12.1711 4.85123 12.1482 4.90461C12.1252 4.95799 12.0919 5.00626 12.0501 5.04662L5.21352 11.8832C5.17292 11.9239 5.12467 11.9562 5.07155 11.9782C5.01843 12.0002 4.96148 12.0115 4.90399 12.0114Z" fill="black"/>
                <path d="M1.75275 12.6876C1.64495 12.6871 1.5411 12.6469 1.46112 12.5746C1.38114 12.5023 1.33065 12.403 1.31932 12.2958C1.30799 12.1886 1.33663 12.081 1.39973 11.9936C1.46284 11.9062 1.55599 11.8452 1.66132 11.8222L4.81197 11.1462C4.92527 11.1223 5.04343 11.1443 5.14056 11.2073C5.23769 11.2703 5.30587 11.3693 5.33016 11.4825C5.35445 11.5957 5.33286 11.714 5.27013 11.8113C5.2074 11.9086 5.10865 11.9771 4.9955 12.0018L1.84485 12.6777C1.8146 12.6843 1.78372 12.6876 1.75275 12.6876ZM10.5032 6.41227C10.4457 6.41238 10.3888 6.40111 10.3357 6.37911C10.2826 6.35711 10.2344 6.32481 10.1939 6.28409L7.71916 3.80937C7.67737 3.76901 7.64405 3.72073 7.62112 3.66736C7.59819 3.61398 7.58612 3.55657 7.58561 3.49848C7.58511 3.44039 7.59618 3.38278 7.61818 3.32901C7.64017 3.27525 7.67266 3.2264 7.71374 3.18532C7.75482 3.14424 7.80366 3.11176 7.85743 3.08976C7.9112 3.06776 7.96881 3.05669 8.0269 3.0572C8.08499 3.0577 8.1424 3.06977 8.19578 3.0927C8.24915 3.11563 8.29743 3.14896 8.33779 3.19074L10.8125 5.66546C10.8737 5.72665 10.9153 5.80459 10.9322 5.88945C10.9491 5.9743 10.9404 6.06225 10.9073 6.14219C10.8742 6.22212 10.8181 6.29044 10.7462 6.33851C10.6743 6.38659 10.5897 6.41225 10.5032 6.41227ZM11.7407 5.17502C11.6541 5.17509 11.5694 5.14947 11.4974 5.1014C11.4254 5.05333 11.3693 4.98498 11.3361 4.90499C11.303 4.82501 11.2943 4.73699 11.3112 4.65208C11.3282 4.56716 11.3699 4.48918 11.4311 4.42799C11.6746 4.18452 11.8087 3.85487 11.8087 3.50005C11.8087 3.14524 11.6746 2.81559 11.4311 2.57212C11.1874 2.32843 10.8578 2.19434 10.503 2.19434C10.1482 2.19434 9.8185 2.32843 9.57504 2.57212C9.5344 2.61275 9.48616 2.64498 9.43307 2.66697C9.37998 2.68897 9.32308 2.70028 9.26561 2.70028C9.20815 2.70028 9.15125 2.68897 9.09816 2.66697C9.04506 2.64498 8.99683 2.61275 8.95619 2.57212C8.91556 2.53148 8.88332 2.48324 8.86133 2.43015C8.83934 2.37706 8.82802 2.32016 8.82802 2.2627C8.82802 2.20523 8.83934 2.14833 8.86133 2.09524C8.88332 2.04215 8.91556 1.99391 8.95619 1.95327C9.36482 1.54443 9.9141 1.31934 10.503 1.31934C11.0916 1.31934 11.6411 1.54443 12.0498 1.95327C12.4586 2.3619 12.6837 2.91118 12.6837 3.50005C12.6837 4.08893 12.4586 4.63821 12.0498 5.04684C12.0092 5.08754 11.9611 5.11982 11.908 5.14182C11.855 5.16382 11.7981 5.1751 11.7407 5.17502Z" fill="black"/>
              </svg>
              <span>Редактировать</span>
            </a>
            <a href="#" class="redact-dropdown-item danger" @click="handleDelete(id, handleShow)">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                <path d="M11.0833 4.0835C10.9286 4.0835 10.7802 4.14495 10.6709 4.25435C10.5615 4.36375 10.5 4.51212 10.5 4.66683V11.1949C10.4833 11.4899 10.3506 11.7663 10.131 11.964C9.91143 12.1616 9.62261 12.2645 9.3275 12.2502H4.6725C4.37739 12.2645 4.08857 12.1616 3.86896 11.964C3.64935 11.7663 3.51673 11.4899 3.5 11.1949V4.66683C3.5 4.51212 3.43854 4.36375 3.32915 4.25435C3.21975 4.14495 3.07138 4.0835 2.91667 4.0835C2.76196 4.0835 2.61358 4.14495 2.50419 4.25435C2.39479 4.36375 2.33333 4.51212 2.33333 4.66683V11.1949C2.34998 11.7994 2.60551 12.3726 3.04394 12.7891C3.48237 13.2055 4.06798 13.4313 4.6725 13.4168H9.3275C9.93202 13.4313 10.5176 13.2055 10.9561 12.7891C11.3945 12.3726 11.65 11.7994 11.6667 11.1949V4.66683C11.6667 4.51212 11.6052 4.36375 11.4958 4.25435C11.3864 4.14495 11.238 4.0835 11.0833 4.0835ZM11.6667 2.3335H9.33333V1.16683C9.33333 1.01212 9.27187 0.863747 9.16248 0.75435C9.05308 0.644954 8.90471 0.583496 8.75 0.583496H5.25C5.09529 0.583496 4.94692 0.644954 4.83752 0.75435C4.72812 0.863747 4.66667 1.01212 4.66667 1.16683V2.3335H2.33333C2.17862 2.3335 2.03025 2.39495 1.92085 2.50435C1.81146 2.61375 1.75 2.76212 1.75 2.91683C1.75 3.07154 1.81146 3.21991 1.92085 3.32931C2.03025 3.4387 2.17862 3.50016 2.33333 3.50016H11.6667C11.8214 3.50016 11.9697 3.4387 12.0791 3.32931C12.1885 3.21991 12.25 3.07154 12.25 2.91683C12.25 2.76212 12.1885 2.61375 12.0791 2.50435C11.9697 2.39495 11.8214 2.3335 11.6667 2.3335ZM5.83333 2.3335V1.75016H8.16667V2.3335H5.83333Z" fill="#F94848"/>
                <path d="M6.41667 9.91667V5.83333C6.41667 5.67862 6.35521 5.53025 6.24581 5.42085C6.13642 5.31146 5.98804 5.25 5.83333 5.25C5.67862 5.25 5.53025 5.31146 5.42085 5.42085C5.31146 5.53025 5.25 5.67862 5.25 5.83333V9.91667C5.25 10.0714 5.31146 10.2197 5.42085 10.3291C5.53025 10.4385 5.67862 10.5 5.83333 10.5C5.98804 10.5 6.13642 10.4385 6.24581 10.3291C6.35521 10.2197 6.41667 10.0714 6.41667 9.91667ZM8.75 9.91667V5.83333C8.75 5.67862 8.68854 5.53025 8.57915 5.42085C8.46975 5.31146 8.32138 5.25 8.16667 5.25C8.01196 5.25 7.86358 5.31146 7.75419 5.42085C7.64479 5.53025 7.58333 5.67862 7.58333 5.83333V9.91667C7.58333 10.0714 7.64479 10.2197 7.75419 10.3291C7.86358 10.4385 8.01196 10.5 8.16667 10.5C8.32138 10.5 8.46975 10.4385 8.57915 10.3291C8.68854 10.2197 8.75 10.0714 8.75 9.91667Z" fill="#F94848"/>
              </svg>
              <span>Удалить</span>
            </a>
          </div>
        </template>
      </v-dropdown>
    </div>
  </div>
</template>

<script>
import VDropdown from '@/components/VDropdown';

export default {
  name: "VLessonCard",

  components: {
    VDropdown
  },

  props: {
    name: {
      type: String,
      default: ''
    },
    duration: {
      type: String,
      default: '2 урока, ~5 минут'
    },
    id: {
      type: Number,
      default: null
    },
    isEditing: {
      type: Boolean,
      default: false
    },
    isEditingAccess: {
      type: Boolean,
      default: false
    },
    isSelectCard: {
      type: Boolean,
      default: false
    },
    isHasOpen: {
      type: Boolean,
      default: false
    },
    isTaskCard: {
      type: Boolean,
      default: false
    },
    taskQuestionCount: {
      type: Number,
      default: 0
    },
    statusId: {
      type: Number,
      default: null
    },
    statusAccessId: {
      type: Number,
      default: null
    }
  },

  data() {
    return {
      selectedId: [],
      status: 2,
      statusList: [
        {
          label: 'Нет доступа',
          id: 2,
        },
        {
          label: 'Доступен',
          id: 1,
        },
      ],
    }
  },

  mounted() {
    this.status = this.statusAccessId
  },

  emits: ['delete', 'edit'],

  computed: {
    statusName() {
      return this.statusList.find(item => item.id === this.status).label
    },
  },

  methods: {
    getClass() {
      if(this.status === 2) {
        return 'danger'
      } else if(this.status === 1) {
        return 'success'
      }
    },
    handleChangeAccessStatus(id, callback) {
      callback();
      this.status = id;
      const body = {
        lesson_id: this.id,
        status: id
      }
      this.API.group.changeAccessStatus(this.$route.params?.id, body)
    },
    handleEdit(id, handleShow = () => {}) {
      handleShow()
      this.$emit('edit', id)
    },
    handleDelete(id, handleShow) {
      handleShow()
      this.$emit('delete', id)
    },
    selectLesson(id) {
      this.$emit('select', id, !!this.selectedId.length)
    }
  }
}
</script>

<style scoped>

</style>
